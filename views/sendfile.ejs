<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encrypt and send file</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="/bs/bootstrap.min.css" rel="stylesheet" >
    <script src="/jss/bootstrap/colors.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3354186740741966" crossorigin="anonymous"></script>
</head>
<body>
    <%- include('partials/header') %>

    <div class="px-4 py-3 my-3 text-center">
        <svg class="bi mt-4 mb-3" style="color: var(--bs-indigo);" width="100" height="100"><use xlink:href="#sftu"/></svg>
        <h1 class="display-5 fw-bold text-body-emphasis">Encrypt the file</h1>
        <div class="col-lg-9 mx-auto">
            <p class="lead mb-4">On this page, you can protect and send your file using encryption directly in your web browser. Once the file is fully encrypted, it's ready to be sent. You'll find the encryption key displayed on the screen below.</p>
            <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                <div class="col-auto">
                    <input type="file" class="form-control" id="fileInput">
                </div>
                <button id="upload_button" onclick="uploadFile('<%= id %>')" type="submit" class="btn btn-primary btn-md px-4 gap-3">Encrypt the file</button>
                <div id="fileInfo" class="container focus-ring py-1 px-2 border rounded-2" style="display: none;">
                    <div class="row">
                        <div class="col">
                            <h4 class="hyphenate">You have selected and encrypted the following file</h4>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p class="hyphenate" id="fileName"></p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p>Size of the file: <span id="fileSize"></span> bytes</p>
                        </div>
                    </div>
                </div>
                <div id="encryption_cancelled" style="display: none;">
                    <h4>Encryption cancelled</h4>
                    <p>The file was not encrypted. Please try again.</p>
                </div>
                <div id="upload_cancelled" style="display: none;">
                    <h4>Upload cancelled</h4>
                    <p>The file was not sent. Please try again.</p>
                </div>
            </div>
        </div>

        <div class="container" id="encryption_key_div" style="display: block">
            <div class="row">
                <div class="col">
                    <p class="fs-5 font-monospace fw-light hyphenate text-center"><h2 class="lead">Encryption key</h2></p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p class="fs-5 font-monospace fw-light hyphenate text-center" id="masterKey"></p>
                </div>
            </div>
        </div>

        <div class="mt-4 container" id="receive_url_div" style="display: none;">
            <div class="row">
                <div class="col">
                    <p>You should share this URL with the recipient to allow them to download the file. Do not close the window!</p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p class="lead">
                        <button class="btn btn-primary" onclick="copyToClipboard('receive_url')">Copy URL</button>
                        <svg onclick="copyToClipboard('receive_url');"  class="bi mt-4 mb-3" style="color: var(--bs-indigo);" width="32" height="32">
                            <use xlink:href="#copy-to-clipboard"/>
                        </svg>
                    </p>
                    <p>Share the URL and do not close the window!</p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p class="fs-5 font-monospace fw-light hyphenate" id="receive_url"><%= receive_url %></p>
                </div>
            </div>
        </div>

    </div>
    <div id="uuid" style="display: none;"><%= id %></div>

    <div class="modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" id="progress-modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="progress-title">Encrypting the file</h4>
                </div>
                <div class="modal-body">
                    <div class="progress" role="progressbar" aria-label="Encryption progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" id="myBar" style="width: 0%"></div>
                    </div>
                    <div class="mt-4">
                        <p class="lead" id="progress-details">0 of 0 bytes</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="cancelProgress()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <%- include('partials/footer') %>
    <script src="/bs/bootstrap.bundle.min.js" ></script>

    <% if (process.env.NODE_ENV === 'production') { %>
    <script src="/jss/send.min.js"></script>
    <script src="/jss/progress.min.js"></script>
    <script src="/jss/main.min.js"></script>
<% } else { %>
    <script src="/jss/send.js"></script>
    <script src="/jss/progress.js"></script>
    <script src="/jss/main.js"></script>
<% } %>

</body>
</html>
